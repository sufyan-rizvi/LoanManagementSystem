@model LoanManagementSystem.Models.LoanApplication

@{
    ViewBag.Title = "Get Loan Documents";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="loader" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); color: white; text-align: center; padding-top: 20%; z-index: 1000;">
    <img src="~/Content/Loader.gif" />
    <h2>Loading...</h2>
</div>
<div>
    <h2>Get Loan Documents</h2>

    <p>
        <button type="button" id="approveBtn" class="btn btn-success">Approve</button> |
        <button type="button" id="rejectBtn" class="btn btn-danger">Reject</button>
    </p>
    <div>
        @Html.TextAreaFor(m => m.Comments, new { @class = "form-control wide-textarea my-4", placeholder = "Give Comments!", id = "comments" })
    </div>

    <table class="table">
        <tr>

            <th>
                @Html.DisplayNameFor(model => model.RegistrationDocuments.First().ImageUrl)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RegistrationDocuments.First().PublicId)
            </th>
        </tr>

        @foreach (var item in Model.RegistrationDocuments)
        {
            <tr>

                <td>

                    <img src="@item.ImageUrl" alt="Uploaded Image" style="width:100px;height:100px;" />

                    @*@Html.DisplayFor(modelItem => item.ImageUrl)*@
                </td>
                <td>

                    <a style="text-decoration:none; color:black" href="@Url.Action("ShowImage", "Customer", new { publicId = item.PublicId })">show image</a>


                </td>



            </tr>
        }

    </table>
</div>
<script>
        $(document).ready(function () {
            $('#approveBtn').click(function () {
                var comments = $('#comments').val();
                if (comments === "") {
                    alert("Please add comments!")
                    return;
                }
                $("#loader").show()
                $.ajax({
                    url: '@Url.Action("ApproveLoan", "LoanOfficer")',
                    type: 'POST',
                    data: {
                        id: '@Model.ApplicationId',
                        comments: comments
                    },
                    success: function (response) {
                        // Handle success, e.g., show a success message or redirect
                        alert("Loan application approved successfully!");
                        $("#loader").hide()
                        // Optionally, redirect to another page
                         window.location.href = '@Url.Action("Welcome", "LoanOfficer")';
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        alert("An error occurred while approving the application.");
                    }
                });
            });

            $('#rejectBtn').click(function () {
                var comments = $('#comments').val();
                if (comments === "") {
                    alert("Please add comments!")
                    return;
                }
                $("#loader").show()
                $.ajax({
                    url: '@Url.Action("RejectLoan", "LoanOfficer")',
                    type: 'POST',
                    data: {
                        id: '@Model.ApplicationId',
                        comments: comments
                    },
                    success: function (response) {
                        // Handle success, e.g., show a success message or redirect
                        alert("Loan application rejected successfully!");
                        // Optionally, redirect to another page
                        $("#loader").hide()
                         window.location.href = '@Url.Action("Welcome", "LoanOfficer")';
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        alert("An error occurred while rejecting the application.");
                    }
                });
            });
        });
</script>






